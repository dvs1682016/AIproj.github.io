<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å®‰å¿ƒæ—¥å¸¸è¨˜éŒ„ï¼ˆç¤ºç¯„ç‰ˆï¼‰</title>
  <meta name="theme-color" content="#111827" />
  <style>
    :root{
      --bg:#0b1220;
      --card:#111827;
      --muted:#9ca3af;
      --text:#f9fafb;
      --accent:#22c55e;
      --accent2:#60a5fa;
      --danger:#ef4444;
      --border:rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 30% -10%, rgba(96,165,250,.18), transparent 60%),
                  radial-gradient(900px 700px at 90% 10%, rgba(34,197,94,.16), transparent 55%),
                  var(--bg);
      color:var(--text);
      padding:18px;
    }
    .wrap{max-width:860px;margin:0 auto}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:14px;
    }
    h1{font-size:22px;margin:0;letter-spacing:.5px}
    .sub{font-size:13px;color:var(--muted);margin-top:4px}
    .pill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--border);
      padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.03);
      white-space:nowrap;
    }
    .card{
      border:1px solid var(--border);
      background:rgba(17,24,39,.92);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
      margin-bottom:14px;
    }

    .dateRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:center;
    }
    .dateControls{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }
    .btnRow{display:flex;gap:10px;flex-wrap:wrap}
    button{
      appearance:none;border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:12px 14px;border-radius:12px;
      font-size:16px;
      cursor:pointer;
      min-height:48px;
    }
    button:active{transform:scale(.99)}
    button.primary{
      border-color: rgba(34,197,94,.45);
      background: rgba(34,197,94,.16);
    }
    button.ghost{
      border-color: rgba(96,165,250,.45);
      background: rgba(96,165,250,.14);
    }
    button.danger{
      border-color: rgba(239,68,68,.5);
      background: rgba(239,68,68,.14);
    }

    .dateBox{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
    }
    input[type="date"]{
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      color:var(--text);
      padding:12px 14px;
      border-radius:12px;
      font-size:16px;
      min-height:48px;
    }
    .hint{color:var(--muted);font-size:13px;line-height:1.5}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 720px){
      .grid{grid-template-columns: 1fr 1fr}
    }

    .metric{
      padding:14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
    }
    .metric h2{
      margin:0 0 8px 0;
      font-size:18px;
      display:flex;align-items:baseline;justify-content:space-between;gap:10px;
    }
    .value{
      font-size:26px;
      font-weight:800;
      letter-spacing:.5px;
    }
    .unit{font-size:13px;color:var(--muted);font-weight:600;margin-left:6px}
    .rangeRow{display:flex;align-items:center;gap:10px;margin-top:8px}
    .minmax{font-size:12px;color:var(--muted);min-width:70px;text-align:center}
    input[type="range"]{
      width:100%;
      height:26px;
      accent-color: var(--accent2);
    }

    textarea{
      width:100%;
      min-height:110px;
      resize:vertical;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      color:var(--text);
      padding:12px 14px;
      border-radius:12px;
      font-size:16px;
      line-height:1.6;
      outline:none;
    }
    textarea::placeholder{color:rgba(156,163,175,.75)}
    .footerRow{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between
    }
    .status{
      color:var(--muted);
      font-size:13px;
    }

    .toast{
      position:fixed;
      left:50%; bottom:18px;
      transform:translateX(-50%);
      background: rgba(17,24,39,.95);
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:999px;
      color:var(--text);
      font-size:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-2px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>å®‰å¿ƒæ—¥å¸¸è¨˜éŒ„ï¼ˆç¤ºç¯„ç‰ˆï¼‰</h1>
        <div class="sub">æ‰‹æ©Ÿå‹å–„ãƒ»å–®ä¸€ HTMLãƒ»è‡ªå‹•å„²å­˜ï¼ˆæœ¬æ©Ÿï¼‰</div>
      </div>
      <div class="pill" id="storagePill">å„²å­˜ï¼šæœ¬æ©Ÿï¼ˆlocalStorageï¼‰</div>
    </header>

    <section class="card">
      <div class="dateRow">
        <div class="dateControls">
          <div class="dateBox">
            <strong style="font-size:16px;">æ—¥æœŸ</strong>
            <input id="dateInput" type="date" />
            <button class="ghost" id="btnToday">ä»Šå¤©</button>
          </div>

          <div class="btnRow">
            <button id="btnPrev">å‰ä¸€å¤©</button>
            <button id="btnNext">å¾Œä¸€å¤©</button>
          </div>
        </div>
        <div class="hint">
          å°æé†’ï¼šé€™å€‹ç‰ˆæœ¬æœƒæŠŠè³‡æ–™å­˜åœ¨æ‰‹æ©Ÿæœ¬æ©Ÿï¼ˆä¸éœ€ç™»å…¥ï¼‰ã€‚ä½ æ›æ‰‹æ©Ÿå°±æœƒæ¶ˆå¤±â€”â€”ä¹‹å¾Œæˆ‘å€‘å†å‡ç´šæˆ IndexedDB / é›²ç«¯ç‰ˆã€‚
        </div>
      </div>
    </section>

    <section class="card">
      <div class="grid">
        <div class="metric">
          <h2>
            <span>èˆ’å¼µå£“</span>
            <span class="value"><span id="diaVal">120</span><span class="unit">mmHg</span></span>
          </h2>
          <div class="rangeRow">
            <div class="minmax">40</div>
            <input id="diaRange" type="range" min="40" max="140" step="1" value="120" />
            <div class="minmax">140</div>
          </div>
          <div class="hint">æ»‘æ¡¿å¾€å³è®Šå¤§ã€å¾€å·¦è®Šå°ï¼ˆé è¨­ 120ï¼‰</div>
        </div>

        <div class="metric">
          <h2>
            <span>æ”¶ç¸®å£“</span>
            <span class="value"><span id="sysVal">70</span><span class="unit">mmHg</span></span>
          </h2>
          <div class="rangeRow">
            <div class="minmax">70</div>
            <input id="sysRange" type="range" min="70" max="220" step="1" value="70" />
            <div class="minmax">220</div>
          </div>
          <div class="hint">ä¾ä½ å…ˆå‰è¨­å®šï¼šé è¨­ 70ï¼ˆä¹‹å¾Œä¹Ÿå¯ä¸€éµæ”¹æˆ 120ï¼‰</div>
        </div>

        <div class="metric">
          <h2>
            <span>å¿ƒè·³</span>
            <span class="value"><span id="hrVal">70</span><span class="unit">æ¬¡/åˆ†</span></span>
          </h2>
          <div class="rangeRow">
            <div class="minmax">40</div>
            <input id="hrRange" type="range" min="40" max="140" step="1" value="70" />
            <div class="minmax">140</div>
          </div>
          <div class="hint">é è¨­ 70</div>
        </div>

        <div class="metric">
          <h2 style="margin-bottom:10px;">å‚™è¨»ï¼ˆç”¨è—¥ï¼æ„Ÿè¦ºï¼‰</h2>
          <textarea id="noteInput" placeholder="ä¾‹å¦‚ï¼šæ—©ä¸Šé£¯å¾Œåƒè—¥ã€é ­æšˆã€ç¡å¾—ä¸éŒ¯ã€èµ°è·¯ 30 åˆ†é˜â€¦"></textarea>
          <div class="hint" style="margin-top:8px;">æ‰“å­—å¾Œæœƒè‡ªå‹•å„²å­˜ï¼ˆä¸ç”¨æŒ‰å¾ˆå¤šæ¬¡ï¼‰ã€‚</div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="footerRow">
        <div class="btnRow">
          <button class="primary" id="btnSave">ç«‹å³å„²å­˜</button>
          <button class="danger" id="btnClearDay">æ¸…é™¤ç•¶æ—¥</button>
        </div>
        <div class="status" id="statusText">å°šæœªå„²å­˜</div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">å·²å„²å­˜ âœ…</div>

  <script>
    /********************
     *  å®‰å¿ƒæ—¥å¸¸è¨˜éŒ„ï¼ˆç¤ºç¯„ç‰ˆï¼‰
     *  MVPï¼šæ—¥æœŸåˆ‡æ› + ä¸‰æ»‘æ¡¿ + å‚™è¨» + æœ¬æ©Ÿå„²å­˜
     *  å„²å­˜æ–¹å¼ï¼šlocalStorageï¼ˆä¹‹å¾Œå¯å‡ç´š IndexedDBï¼‰
     ********************/

    const STORAGE_KEY = "anxin_daily_records_v1";

    // é è¨­å€¼ï¼ˆä¾ä½ ä¹‹å‰çš„æè¿°ï¼‰
    const DEFAULTS = {
      dia: 120, // èˆ’å¼µå£“ï¼ˆä½ å…ˆå‰æŒ‡å®š 120ï¼‰
      sys: 70,  // æ”¶ç¸®å£“ï¼ˆä½ å…ˆå‰æŒ‡å®š 70ï¼‰
      hr: 70,
      note: ""
    };

    const el = {
      dateInput: document.getElementById("dateInput"),
      btnPrev: document.getElementById("btnPrev"),
      btnNext: document.getElementById("btnNext"),
      btnToday: document.getElementById("btnToday"),
      btnSave: document.getElementById("btnSave"),
      btnClearDay: document.getElementById("btnClearDay"),

      diaRange: document.getElementById("diaRange"),
      sysRange: document.getElementById("sysRange"),
      hrRange: document.getElementById("hrRange"),
      noteInput: document.getElementById("noteInput"),

      diaVal: document.getElementById("diaVal"),
      sysVal: document.getElementById("sysVal"),
      hrVal: document.getElementById("hrVal"),

      statusText: document.getElementById("statusText"),
      toast: document.getElementById("toast"),
    };

    let saveTimer = null;
    let dirty = false;

    function pad2(n){ return String(n).padStart(2, "0"); }

    function toISODate(d){
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    }

    function fromISODate(s){
      const [y,m,dd] = s.split("-").map(Number);
      return new Date(y, m-1, dd);
    }

    function addDays(isoDateStr, delta){
      const d = fromISODate(isoDateStr);
      d.setDate(d.getDate() + delta);
      return toISODate(d);
    }

    function loadAll(){
      try{
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
      }catch{
        return {};
      }
    }

    function saveAll(obj){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
    }

    function getRecord(dateStr){
      const all = loadAll();
      return all[dateStr] || null;
    }

    function setRecord(dateStr, record){
      const all = loadAll();
      all[dateStr] = record;
      saveAll(all);
    }

    function deleteRecord(dateStr){
      const all = loadAll();
      delete all[dateStr];
      saveAll(all);
    }

    function setDirty(flag){
      dirty = flag;
      el.statusText.textContent = flag ? "å°šæœªå„²å­˜ï¼ˆæœƒè‡ªå‹•å„²å­˜ï¼‰" : "å·²å„²å­˜";
    }

    function showToast(text="å·²å„²å­˜ âœ…"){
      el.toast.textContent = text;
      el.toast.classList.add("show");
      setTimeout(()=> el.toast.classList.remove("show"), 900);
    }

    function applyToUI(record){
      const r = record || DEFAULTS;

      el.diaRange.value = r.dia ?? DEFAULTS.dia;
      el.sysRange.value = r.sys ?? DEFAULTS.sys;
      el.hrRange.value  = r.hr  ?? DEFAULTS.hr;
      el.noteInput.value = r.note ?? DEFAULTS.note;

      refreshNumbers();
    }

    function readFromUI(){
      return {
        dia: Number(el.diaRange.value),
        sys: Number(el.sysRange.value),
        hr: Number(el.hrRange.value),
        note: String(el.noteInput.value || "").trim(),
        updatedAt: new Date().toISOString()
      };
    }

    function refreshNumbers(){
      el.diaVal.textContent = el.diaRange.value;
      el.sysVal.textContent = el.sysRange.value;
      el.hrVal.textContent  = el.hrRange.value;
    }

    function scheduleAutoSave(){
      setDirty(true);
      if (saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        saveNow(true);
      }, 500);
    }

    function saveNow(isAuto=false){
      const dateStr = el.dateInput.value;
      if (!dateStr) return;

      const record = readFromUI();
      setRecord(dateStr, record);
      setDirty(false);

      if (isAuto) showToast("è‡ªå‹•å„²å­˜ âœ…");
      else showToast("å·²å„²å­˜ âœ…");
    }

    function switchDate(newDateStr){
      // å…ˆæŠŠæœªå„²å­˜çš„ä¹Ÿå­˜èµ·ä¾†ï¼ˆé¿å…åˆ‡æ—¥æœŸè³‡æ–™ä¸è¦‹ï¼‰
      if (dirty) saveNow(true);

      el.dateInput.value = newDateStr;

      const rec = getRecord(newDateStr);
      applyToUI(rec);
      setDirty(false);

      el.statusText.textContent = rec ? "å·²è¼‰å…¥ï¼ˆå¯ç›´æ¥ä¿®æ”¹ï¼‰" : "æ–°çš„ä¸€å¤©ï¼ˆå°šæœªæœ‰ç´€éŒ„ï¼‰";
    }

    // --- ç¶å®šäº‹ä»¶ ---
    el.diaRange.addEventListener("input", () => { refreshNumbers(); scheduleAutoSave(); });
    el.sysRange.addEventListener("input", () => { refreshNumbers(); scheduleAutoSave(); });
    el.hrRange.addEventListener("input",  () => { refreshNumbers(); scheduleAutoSave(); });
    el.noteInput.addEventListener("input", () => scheduleAutoSave());

    el.btnSave.addEventListener("click", () => saveNow(false));

    el.btnClearDay.addEventListener("click", () => {
      const dateStr = el.dateInput.value;
      if (!dateStr) return;

      // å…ˆæ¸…é™¤è³‡æ–™ï¼Œå†æ¢å¾©é è¨­å€¼
      deleteRecord(dateStr);
      applyToUI(null);
      setDirty(false);
      showToast("å·²æ¸…é™¤ç•¶æ—¥ ğŸ§¹");
      el.statusText.textContent = "ç•¶æ—¥å·²æ¸…é™¤ï¼ˆå›åˆ°é è¨­å€¼ï¼‰";
    });

    el.btnPrev.addEventListener("click", () => {
      const cur = el.dateInput.value;
      if (!cur) return;
      switchDate(addDays(cur, -1));
    });

    el.btnNext.addEventListener("click", () => {
      const cur = el.dateInput.value;
      if (!cur) return;
      switchDate(addDays(cur, 1));
    });

    el.btnToday.addEventListener("click", () => {
      switchDate(toISODate(new Date()));
    });

    el.dateInput.addEventListener("change", () => {
      if (!el.dateInput.value) return;
      switchDate(el.dateInput.value);
    });

    // --- åˆå§‹å•Ÿå‹• ---
    (function init(){
      const today = toISODate(new Date());
      el.dateInput.value = today;

      const rec = getRecord(today);
      applyToUI(rec);
      el.statusText.textContent = rec ? "å·²è¼‰å…¥ä»Šæ—¥ç´€éŒ„" : "ä»Šå¤©å°šæœªæœ‰ç´€éŒ„ï¼ˆå¯ç›´æ¥è¼¸å…¥ï¼‰";
      setDirty(false);

      // iOS æœ‰æ™‚æœƒæŠŠ date æ–‡å­—é¡¯ç¤ºæˆè‹±æ–‡ï¼Œé€™è£¡ç„¡éœ€è™•ç†ï¼ˆåŠŸèƒ½æ­£å¸¸ï¼‰
    })();
  </script>
</body>
</html>
